swagger: "2.0"
consumes:
  - application/json
info:
  description: "Welcome to the otto-js (Alerts) API  documentation! otto-js is a powerful platform that offers a range of services to ensure the security, compliance, and integrity of your web applications. The api endpoints enable users to retrieve alerts and notifications generated by otto-js. The alerts endpoints include: Known Vulnerabilities, Changes to JavaScript, and Action Required."
  termsOfService: https://www.otto-js.com/terms
  title: "otto-js (Alerts) API Documentation"
  version: "2.0"
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html
tags:
  - name: Site
    description: "This endpoint retrieves details about all sites added to otto-js."
  - name: Vulnerabilities
    description: "This endpoint retrieves details about all file vulnerabilities detected by otto-js."
  - name: Behavior
    description: "This endpoint retrieves details about all changes to script behaviors detected by otto-js."
  - name: Incident
    description: "This endpoint retrieves details about incidents detected by otto-js. These can be firewall violations, script violations, and blocked malware."
  - name: Users
    description: "This endpoint retrieves details about users for the account"
  - name: Groups
    description: "This endpoint allows you to create groupings of sites and control which users are able to view those sites. A Group could be different companies you manage or different user access roles."
  - name: Browser Firewall
    description: "This endpoint allows you manage browser firewall rules like deny all scripts access to password, or allow a subset of scripts to read pii"
  - name: PCI Reports 
    description: "This endpoint allows you manage Script Attestation reports to maintain PCI V4 compliance"
paths:
  /api/v2/accounts/{account_id}/sites:
    get:
      security:
        - { Bearer: [] }
      description: Get a list of all sites in the account.
      operationId: DevconServicesApiWeb.SiteController.index
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
      produces:
        - application/json
      responses:
        "200":
          description: Success
          schema:
            type: object
            properties:
              data:
                $ref: "#/definitions/Sites"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: "Get a list of site_ids that can be used in later API requests to query data specific to that site."
      tags:
        - Site
    post:
      security:
        - { Bearer: [] }
      description: Add a site to the account.
      operationId: DevconServicesApiWeb.SiteController.create
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: body
          name: body
          description: "Site Settings"
          required: true
          schema:
            type: object
            properties:
              site:
                type: object
                properties:
                  url:
                    type: string
      produces:
        - application/json
      responses:
        "200":
          description: Success
          schema:
            type: object
            properties:
              data:
                $ref: "#/definitions/Site"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: "Create a new site"
      tags:
        - Site

  /api/v2/accounts/{account_id}/sites/{site_id}:
    get:
      security:
        - { Bearer: [] }
      description: Get details for a specific site.
      operationId: DevconServicesApiWeb.SiteController.show
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: site_id
          required: true
          type: string
      produces:
        - application/json
      responses:
        "200":
          description: Success
          schema:
            type: object
            properties:
              data:
                $ref: "#/definitions/Site"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: "Get info related to a specific site_id."
      tags:
        - Site
  /api/v2/me:
    get:
      security:
        - { Bearer: [] }
      description: Get the current user information
      operationId: DevconServicesApiWeb.MeController.index
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
      produces:
        - application/json
      responses:
        "200":
          description: Success
          schema:
            type: object
            properties:
              data:
                $ref: "#/definitions/User"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: Get the current user information
      tags:
        - Users

  /api/v2/accounts/{account_id}/users:
    get:
      security:
        - { Bearer: [] }
      description: Get users for an account.
      operationId: DevconServicesApiWeb.UserController.index
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
      produces:
        - application/json
      responses:
        "200":
          description: Success
          schema:
            type: object
            properties:
              data:
                $ref: "#/definitions/Users"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: "Get a list of groups for the account"
      tags:
        - Users

  /api/v2/accounts/{account_id}/users/{user_id}:
    get:
      security:
        - { Bearer: [] }
      description: Get user info by id.
      operationId: DevconServicesApiWeb.UserController.show
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: user_id
          required: true
          type: string
      produces:
        - application/json
      responses:
        "200":
          description: Success
          schema:
            type: object
            properties:
              data:
                $ref: "#/definitions/User"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: "Get user by id"
      tags:
        - Users
    put:
      security:
        - { Bearer: [] }
      description: Update user info by id.
      operationId: DevconServicesApiWeb.UserController.update
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: user_id
          required: true
          type: string
        - in: body
          name: body
          description: "User Info"
          required: true
          schema:
            type: object
            properties:
              email:
                type: string
              name:
                type: string
      produces:
        - application/json
      responses:
        "200":
          description: Success
          schema:
            type: object
            properties:
              data:
                $ref: "#/definitions/User"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: "Update user info"
      tags:
        - Users
  /api/v2/accounts/{account_id}/users/{user_id}/kick:
    delete:
      security:
        - { Bearer: [] }
      description: Delete the user from the account.
      operationId: DevconServicesApiWeb.UserController.kick
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: user_id
          required: true
          type: string
      produces:
        - application/json
      responses:
        "200":
          description: Success
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: "Delete the user from the account"
      tags:
        - Users

  /api/v2/accounts/{account_id}/groups:
    get:
      security:
        - { Bearer: [] }
      description: Get groups details for a specific site.
      operationId: DevconServicesApiWeb.GroupController.index
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
      produces:
        - application/json
      responses:
        "200":
          description: Success
          schema:
            type: object
            properties:
              data:
                $ref: "#/definitions/Groups"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: "Get a list of groups for the account"
      tags:
        - Groups
    post:
      security:
        - { Bearer: [] }
      description: Create a new Group.
      operationId: DevconServicesApiWeb.GroupController.create
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: body
          name: body
          description: "Group"
          required: true
          schema:
            type: object
            properties:
              group:
                type: object
                properties:
                  name:
                    type: string

      produces:
        - application/json
      responses:
        "200":
          description: Success
          schema:
            type: object
            properties:
              data:
                $ref: "#/definitions/Group"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: "Add group to the account"
      tags:
        - Groups

  /api/v2/accounts/{account_id}/groups/{group_id}:
    put:
      security:
        - { Bearer: [] }
      description: Update a Group Name.
      operationId: DevconServicesApiWeb.GroupController.update
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: group_id
          required: true
          type: string
        - in: body
          name: body
          description: "Group"
          required: true
          schema:
            type: object
            properties:
              group:
                type: object
                properties:
                  name:
                    type: string
      produces:
        - application/json
      responses:
        "200":
          description: Success
          schema:
            type: object
            properties:
              data:
                $ref: "#/definitions/Group"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: "Update the Group Name"
      tags:
        - Groups
    delete:
      security:
        - { Bearer: [] }
      description: Delete a Group.
      operationId: DevconServicesApiWeb.GroupController.delete
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: group_id
          required: true
          type: string
      produces:
        - application/json
      responses:
        "200":
          description: Success
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: "Delete a Group Name"
      tags:
        - Groups

  /api/v2/accounts/{account_id}/groups/{group_id}/sites/{site_id}:
    post:
      security:
        - { Bearer: [] }
      description: Get groups details for a specific site.
      operationId: DevconServicesApiWeb.GroupController.add_site
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: group_id
          required: true
          type: string
        - in: path
          name: site_id
          required: true
          type: string
      produces:
        - application/json
      responses:
        "200":
          description: Success
          schema:
            type: object
            properties:
              data:
                $ref: "#/definitions/Groups"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: "Add a site to the group"
      tags:
        - Groups
    delete:
      security:
        - { Bearer: [] }
      description: Delete a site from the group.
      operationId: DevconServicesApiWeb.GroupController.remove_site
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: group_id
          required: true
          type: string
        - in: path
          name: site_id
          required: true
          type: string
      produces:
        - application/json
      responses:
        "200":
          description: Success
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: "Delete a site from the group"
      tags:
        - Groups

  /api/v2/accounts/{account_id}/groups/{group_id}/users/{user_id}:
    post:
      security:
        - { Bearer: [] }
      description: Add User to a group.
      operationId: DevconServicesApiWeb.GroupController.add_user
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: group_id
          required: true
          type: string
        - in: path
          name: user_id
          required: true
          type: string
      produces:
        - application/json
      responses:
        "200":
          description: Success
          schema:
            type: object
            properties:
              data:
                $ref: "#/definitions/Group"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: "Add a user to the group"
      tags:
        - Groups
    delete:
      security:
        - { Bearer: [] }
      description: Delete a user from the group.
      operationId: DevconServicesApiWeb.GroupController.remove_user
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: group_id
          required: true
          type: string
        - in: path
          name: user_id
          required: true
          type: string
      produces:
        - application/json
      responses:
        "200":
          description: Success
          schema:
            type: object
            properties:
              data:
                $ref: "#/definitions/Group"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: "Remmove a user from the group"
      tags:
        - Groups

  /api/v2/accounts/{account_id}/sites/{site_id}/files:
    get:
      security:
        - { Bearer: [] }
      description: Get a list of all JavaScript files with vulnerabilties.
      operationId: DevconServicesApiWeb.FileController.index
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: site_id
          required: true
          type: string
      produces:
        - application/json
      responses:
        "200":
          description: Success
          schema:
            type: object
            properties:
              data:
                $ref: "#/definitions/Vulnerabilities"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: "Get a list of all JavaScript vulnerabilties."
      tags:
        - Vulnerabilities
  /api/v2/accounts/{account_id}/sites/{site_id}/files/{file_id}:
    get:
      security:
        - { Bearer: [] }
      description: Get a file's vulnerability details.
      operationId: DevconServicesApiWeb.FileController.show
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: site_id
          required: true
          type: string
        - in: path
          name: file_id
          required: true
          type: string
      produces:
        - application/json
      responses:
        "200":
          description: Success
          schema:
            type: object
            properties:
              data:
                $ref: "#/definitions/Vulnerability"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: "Get a file's vulnerability details."
      tags:
        - Vulnerabilities
  /api/v2/accounts/{account_id}/sites/{site_id}/incidents:
    get:
      security:
        - { Bearer: [] }
      description: |
        Get a list of Action Required incidents.
        **mode** param can be one of the following:
          * **quarantine**: all blocked events
          * **review**: high risk items that need review
          * **new**: All events in the last 24 hours
          * **all**: Archive of all events
      operationId: DevconServicesApiWeb.IncidentController.index
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: site_id
          required: true
          type: string
        - in: query
          name: mode
          required: true
          type: string
          default: review
      produces:
        - application/json
      responses:
        "200":
          description: Success
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: "Get a list of Action Required incidents."
      tags:
        - Incident
  /api/v2/accounts/{account_id}/sites/{site_id}/incidents/{incident_id}:
    get:
      security:
        - { Bearer: [] }
      description: Get an incident's details.
      operationId: DevconServicesApiWeb.IncidentController.show
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: site_id
          required: true
          type: string
        - in: path
          name: incident_id
          required: true
          type: string
      responses:
        "200":
          description: Success
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: "Get an incident's details."
      tags:
        - Incident
  /api/v2/accounts/{account_id}/sites/{site_id}/aggregate_incidents:
    get:
      security:
        - { Bearer: [] }
      description: |
        Get a list of Action Required incidents. Must supply **mode** and **incident_type** in the query string.
        * **mode** param can be one of the following:
          * **quarantine**: all blocked events
          * **review**: high risk items that need review
          * **all**: Archive of all events
          * **new**: All events in the last 24 hours
        * **incident_type** param can be one of the following:
          * **all**: Show all incidents
          * **file**: Show all js files with vulnerabilities
          * **network_requests**: Shows only network requests
          * **policy_violations**: All Script Policy Violations
          * **violations**: All Content Security Policy Violations
      operationId: DevconServicesApiWeb.AggregateIncidentController.index
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: site_id
          required: true
          type: string
        - in: query
          name: mode
          required: true
          type: string
          default: quarantine
        - in: query
          name: incident_type
          required: true
          type: string
          default: all
      produces:
        - application/json
      responses:
        "200":
          description: Success
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: "Get a list of Action Required incidents."
      tags:
        - Incident
  /api/v2/accounts/{account_id}/sites/{site_id}/behaviors/need_review:
    get:
      security:
        - { Bearer: [] }
      description: Get a listing of any scripts under site {site_id} whose behavior has changed and could potentially be a security threat.
      operationId: DevconServicesApiWeb.BehaviorController.need_review
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: site_id
          required: true
          type: string
      responses:
        "200":
          description: Success
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: Get a listing of any scripts under site {site_id} whose behavior has changed and could potentially be a security threat.
      tags:
        - Behavior
  ? /api/v2/accounts/{account_id}/sites/{site_id}/behaviors/mark_as_reviewed/{behavior_id}
  : put:
      security:
        - { Bearer: [] }
      description: Mark a behavior that requires review as having been reviewed.
      operationId: DevconServicesApiWeb.BehaviorController.mark_as_reviewed
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: site_id
          required: true
          type: string
        - in: path
          name: behavior_id
          required: true
          type: string
      responses:
        "200":
          description: Success
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: "Mark a behavior that needed review as having been reviewed."
      tags:
        - Behavior
  /api/v2/accounts/{account_id}/sites/{site_id}/behaviors/{behavior_id}:
    get:
      security:
        - { Bearer: [] }
      description: Get details on a certain behavior belonging to a site {site_id}.
      operationId: DevconServicesApiWeb.BehaviorController.show
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: site_id
          required: true
          type: string
        - in: path
          name: behavior_id
          required: true
          type: string
      responses:
        "200":
          description: Success
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: "Get details on a certain behavior recorded on a site."
      tags:
        - Behavior
  /api/v2/accounts/{account_id}/sites/{site_id}/policies:
    get:
      security:
        - { Bearer: [] }
      description: Get Browser Firewall Policies for {site_id}.
      operationId: DevconServicesApiWeb.PolicyController.index
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: site_id
          required: true
          type: string
        - in: path
          name: behavior_id
          required: true
          type: string
      responses:
        "200":
          description: Success
          schema:
            type: object
            properties:
              data:
                $ref: "#/definitions/Policies"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: "Get all browser firewall policies"
      tags:
        - Browser Firewall
  /api/v2/accounts/{account_id}/sites/{site_id}/policies/{policy_id}:
    get:
      security:
        - { Bearer: [] }
      description: Get Browser Firewall Policy for {site_id} and {policy_id}.
      operationId: DevconServicesApiWeb.PolicyController.show
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: site_id
          required: true
          type: string
        - in: path
          name: policy_id
          required: true
          type: string
      responses:
        "200":
          description: Success
          schema:
            type: object
            properties:
              data:
                $ref: "#/definitions/Policy"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: "Get details for a browser firewall policy"
      tags:
        - Browser Firewall
    put:
      security:
        - { Bearer: [] }
      description: Update a browser firewall policy for {site_id} and {policy_id} and/or create a custom policy.
      operationId: DevconServicesApiWeb.PolicyController.update
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: site_id
          required: true
          type: string
        - in: path
          name: policy_id
          required: true
          type: string
        - in: body
          name: body
          description: "Policy to Update"
          required: true
          schema:
            type: object
            properties:
              policy:
                type: object
                properties:
                  site_id:
                    type: string
                  active:
                    type: boolean
                  policy:
                    type: array
                    items:
                      type: object
                      properties:
                        action:
                          type: string
                        resource:
                          type: object
                          properties:
                            params:
                              type: array
                              items:
                                type: string
                            type:
                              type: string
                        script:
                          type: string

      responses:
        "200":
          description: Success
          schema:
            type: object
            properties:
              data:
                $ref: "#/definitions/Policy"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: Update a browser firewall policy for {site_id} and {policy_id} and/or create a custom policy.
      tags:
        - Browser Firewall
  /api/v2/accounts/{account_id}/sites/{site_id}/policies/{policy_id}/firewall_all:
    put:
      security:
        - { Bearer: [] }
      description: Create a Browser Firewall Policy to prevent all scripts from reading any inputs
      operationId: DevconServicesApiWeb.PolicyController.create_all_policy
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: site_id
          required: true
          type: string
        - in: path
          name: policy_id
          required: true
          type: string
      responses:
        "200":
          description: Success
          schema:
            type: object
            properties:
              data:
                $ref: "#/definitions/Policy"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: Create a Browser Firewall Policy to prevent all scripts from reading any inputs
      tags:
        - Browser Firewall
  /api/v2/accounts/{account_id}/sites/{site_id}/policies/{policy_id}/firewall_ccn:
    put:
      security:
        - { Bearer: [] }
      description: Create a Browser Firewall Policy to prevent all scripts from reading any financial inputs like credit card numbers
      operationId: DevconServicesApiWeb.PolicyController.create_credit_card_policy
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: site_id
          required: true
          type: string
        - in: path
          name: policy_id
          required: true
          type: string
      responses:
        "200":
          description: Success
          schema:
            type: object
            properties:
              data:
                $ref: "#/definitions/Policy"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: Create a Browser Firewall Policy to prevent all scripts from reading any financial inputs like credit card numbers
      tags:
        - Browser Firewall
  /api/v2/accounts/{account_id}/sites/{site_id}/policies/{policy_id}/firewall_pii:
    put:
      security:
        - { Bearer: [] }
      description: Create a Browser Firewall Policy to prevent all scripts from reading credentials and other pii data
      operationId: DevconServicesApiWeb.PolicyController.create_pii_policy
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: site_id
          required: true
          type: string
        - in: path
          name: policy_id
          required: true
          type: string
      responses:
        "200":
          description: Success
          schema:
            type: object
            properties:
              data:
                $ref: "#/definitions/Policy"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: Create a Browser Firewall Policy to prevent all scripts from reading credentials and other pii data
      tags:
        - Browser Firewall
  /api/v2/accounts/{account_id}/sites/{site_id}/policies/{policy_id}/enable/{enable}:
    put:
      security:
        - { Bearer: [] }
      description: Enable or Disable the firewall
      operationId: DevconServicesApiWeb.PolicyController.enable_policy
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: site_id
          required: true
          type: string
        - in: path
          name: policy_id
          required: true
          type: string
        - in: path
          name: enable
          required: true
          type: boolean
      responses:
        "200":
          description: Success
          schema:
            type: object
            properties:
              data:
                $ref: "#/definitions/Policy"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: Enable or Disable the firewall
      tags:
        - Browser Firewall
  /api/v2/accounts/{account_id}/sites/{site_id}/pci_reports:
    get:
      security:
        - { Bearer: [] }
      description: Get all PCI Attestation Reports for a site id. Includes completed and incomplete reports. 
      operationId: DevconServicesApiWeb.PciReportController.index
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: site_id
          required: true
          type: string
      responses:
        "200":
          description: Success
          schema:
            type: object
            properties:
              data:
                $ref: "#/definitions/PCIReports"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: Get all PCI Attestation Reports for a site id. Includes completed and incomplete reports. 
      tags:
        - PCI Reports
    post:
      security:
        - { Bearer: [] }
      description: Start a new PCI report for the {site_id}. This will include all scripts seen in the last 30 days. 
      operationId: DevconServicesApiWeb.PciReportController.create
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: site_id
          required: true
          type: string
      responses:
        "200":
          description: Success
          schema:
            type: object
            properties:
              data:
                $ref: "#/definitions/PCIReport"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: Start a new PCI report for the {site_id}. This will include all scripts seen in the last 30 days. 
      tags:
        - PCI Reports
  /api/v2/accounts/{account_id}/sites/{site_id}/pci_reports/{report_id}:
    get:
      security:
        - { Bearer: [] }
      description: Get PCI Report details for {report_id} 
      operationId: DevconServicesApiWeb.PciReportController.show
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: site_id
          required: true
          type: string
        - in: path
          name: report_id
          required: true
          type: string
      responses:
        "200":
          description: Success
          schema:
            type: object
            properties:
              data:
                $ref: "#/definitions/PCIReport"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: Get PCI Report details for {report_id} 
      tags:
        - PCI Reports
  /api/v2/accounts/{account_id}/sites/{site_id}/pci_reports/{report_id}/complete:
    post:
      security:
        - { Bearer: [] }
      description: Complete the PCI Report. This will save and archive all attestations.
      operationId: DevconServicesApiWeb.PciReportController.complete
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: site_id
          required: true
          type: string
        - in: path
          name: report_id
          required: true
          type: string
        - in: body
          name: body
          description: "Attestation that the report is complete. Can include a signature of the authorizer (optional). Signature should be a base64 encoded image like : `data:image/png;base64,XXXXXXXX`"
          required: true
          schema:
            type: object
            properties:
              pci_report:
                type: object
                properties:
                  signature:
                    type: string
                  full_name:
                    type: string

      responses:
        "200":
          description: Success
          schema:
            type: object
            properties:
              data:
                $ref: "#/definitions/PCIReport"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: Complete the PCI Report. This will save and archive all attestations.
      tags:
        - PCI Reports
  /api/v2/accounts/{account_id}/sites/{site_id}/pci_reports/{report_id}/script_attestations:
    get:
      security:
        - { Bearer: [] }
      description: Get all PCI Attestations for the scripts in the {report_id}. 
      operationId: DevconServicesApiWeb.ScriptAttestationController.index
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: site_id
          required: true
          type: string
        - in: path
          name: report_id
          required: true
          type: string
      responses:
        "200":
          description: Success
          schema:
            type: object
            properties:
              data:
                $ref: "#/definitions/Attestations"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: Get all PCI Attestations for the scripts in the {report_id}. 
      tags:
        - PCI Reports
    post:
      security:
        - { Bearer: [] }
      description: Add a script attestation for to the PCI Report. 
      operationId: DevconServicesApiWeb.ScriptAttestationController.create
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: site_id
          required: true
          type: string
        - in: path
          name: report_id
          required: true
          type: string
        - in: body
          name: body
          description: "Attestation why this script is nessessary. The approved state will add the current authenticated user as the approver.  "
          required: true
          schema:
            type: object
            properties:
              attestation:
                type: object
                properties:
                  justification:
                    type: string
                  approved:
                    type: boolean
                  network_request_id:
                    type: string

      responses:
        "200":
          description: Success
          schema:
            type: object
            properties:
              data:
                $ref: "#/definitions/Attestation"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: Add a script attestation for to the PCI Report. 
      tags:
        - PCI Reports
  /api/v2/accounts/{account_id}/sites/{site_id}/pci_reports/{report_id}/script_attestations/{attestation_id}:
    patch:
      security:
        - { Bearer: [] }
      description: Update the script attestation. 
      operationId: DevconServicesApiWeb.ScriptAttestationController.update
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: site_id
          required: true
          type: string
        - in: path
          name: report_id
          required: true
          type: string
        - in: path
          name: attestation_id
          required: true
          type: string
        - in: body
          name: body
          description: "Attestation why this script is nessessary. The approved state will add the current authenticated user as the approver.  "
          required: true
          schema:
            type: object
            properties:
              attestation:
                type: object
                properties:
                  justification:
                    type: string
                  approved:
                    type: boolean
                  network_request_id:
                    type: string
      responses:
        "200":
          description: Success
          schema:
            properties:
              data:
                $ref: "#/definitions/Attestation"
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: Update the script attestation. 
      tags:
        - PCI Reports
    delete:
      security:
        - { Bearer: [] }
      description: Delete this script attestation. 
      operationId: DevconServicesApiWeb.ScriptAttestationController.delete
      parameters:
        - in: path
          name: account_id
          required: true
          type: string
        - in: path
          name: site_id
          required: true
          type: string
        - in: path
          name: report_id
          required: true
          type: string
        - in: path
          name: attestation_id
          required: true
          type: string
      responses:
        "200":
          description: Success
        "403":
          description: Not Authorized
        "404":
          description: Not Found
      summary: Delete this script attestation. 
      tags:
        - PCI Reports
definitions:
  Group:
    type: object
    properties:
      account_id:
        type: string
      id:
        type: string
      inserted_at:
        type: string
      name:
        type: string
      sites:
        type: array
        items:
          $ref: "#definitions/Site"
      users:
        type: array
        items:
          $ref: "#definitions/User"
  Groups: 
    type: array
    items:
      $ref: "#/definitions/Group"
  User:
    type: object
    properties:
      account_description:
        type: string
      account_id:
        type: string
      account_name:
        type: string
      auth0_user_id:
        type: string
      email:
        type: string
      groups:
        type: array
        items:
          type: object
          properties:
            id: 
              type: string
            name: 
              type: string
      id:
        type: string
      name:
        type: string
      terms_and_conditions_accepted_at:
        type: boolean
  Site: 
    type: object
    properties:
      account_id:
        type: string
      groups:
        type: array
        items:
          type: object
          properties:
            id:
              type: string
            name:
              type: string
      id:
        type: string
      inserted_at:
        type: string
      is_monitored:
        type: boolean
      url:
        type: string
  Sites: 
    type: array
    items:
      $ref: "#/definitions/Site"
  Policy: 
    type: object
    properties:
      active:
        type: boolean
      created_by_avatar:
        type: string
      created_by_name:
        type: string
      id:
        type: string
      inserted_at:
        type: string
      policy:
        type: array
        items:
          type: object
          properties:
            action:
              type: string
            resource:
              type: object
              properties:
                params:
                  type: array
                  items:
                    type: string
                type:
                  type: string
            script:
              type: string
      site_id:
        type: string
      updated_at:
        type: string
  Policies: 
    type: array
    items:
      $ref: "#/definitions/Policy"
  PCIReport: 
    type: object
    properties:
      completed:
        type: boolean
      completed_at:
        type: string
      completed_by:
        type: string
      full_name:
        type: string
      id:
        type: string
      pci1161_link:
        type: string
      pci643_link:
        type: string
      quarter:
        type: string
      signature:
        type: string
  PCIReports:
    type: array
    items:
      $ref: "#/definitions/PCIReport"
  Attestation: 
    type: object
    properties:
      acted_on_by:
        type: object
        properties:
      acted_on_by_id:
        type: object
        properties:
      attestation:
        type: object
        properties:
          approved:
            type: boolean
          id:
            type: string
          inserted_at:
            type: string
          justification:
            type: string
          network_request_id:
            type: string
          pci_report_id:
            type: string
          script_path:
            type: string
          updated_at:
            type: string
          user:
            type: object
            properties:
              id:
                type: string
              name:
                type: string
              email:
                type: string
              account_id:
                type: string
          user_id:
            type: string
      blocked:
        type: boolean
      changes_dom:
        type: object
        properties:
      cookies_read:
        type: object
        properties:
      cookies_write:
        type: object
        properties:
      count:
        type: number
      deleted:
        type: boolean
      hostname:
        type: string
      id:
        type: string
      ignored:
        type: boolean
      initiator:
        type: object
        properties:
      inserted_at:
        type: string
      is_blocked:
        type: boolean
      keylogging:
        type: object
        properties:
      known_group:
        type: object
        properties:
      known_group_id:
        type: object
        properties:
      live_mode:
        type: boolean
      local_storage_read:
        type: object
        properties:
      local_storage_write:
        type: object
        properties:
      other_network:
        type: object
        properties:
      reads_inputs:
        type: object
        properties:
      request_type:
        type: string
      resolved:
        type: boolean
      session_storage_read:
        type: object
        properties:
      session_storage_write:
        type: object
        properties:
      severity:
        type: number
      site_id:
        type: string
      updated_at:
        type: string
      url_found_on:
        type: string

  Attestations:
    type: array
    items:
      $ref: "#/definitions/Attestation"

  Vulnerability: 
    type: object
    properties:
      file_sites:
        type: array
        items:
          type: object
          properties:
            file_id:
              type: string
            id:
              type: string
            inserted_at:
              type: string
            last_seen:
              type: string
            site_id:
              type: string
            updated_at:
              type: string
            url_found_on:
              type: string
      hash:
        type: string
      id:
        type: string
      inserted_at:
        type: string
      is_vulnerable:
        type: boolean
      name:
        type: string
      original_url:
        type: string
      severity:
        type: number
      updated_at:
        type: string
      url:
        type: string
      version:
        type: string
      vulnerability_info:
        type: array
        items:
          type: object
          properties:
            above:
              type: object
              properties:
            below:
              type: string
            id:
              type: string
            identifiers:
              type: object
              properties:
                CVE:
                  type: array
                  items:
                    type: string
                githubID:
                  type: string
                issue:
                  type: string
                summary:
                  type: string
            info:
              type: array
              items:
                type: string
            severity:
              type: string
  Vulnerabilities:
    type: array
    items:
      $ref: "#definitions/Vulnerability"


produces:
  - application/json
host: api.otto-js.com
schemes:
  - https
securityDefinitions:
  Bearer:
    description: "API Token must be provided via `Authorization: Bearer ` header"
    in: header
    name: Authorization
    type: apiKey
